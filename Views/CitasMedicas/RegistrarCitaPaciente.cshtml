@{
    ViewData["Title"] = "Registrar Cita Médica";
}

<style>
.container {
    max-width: 600px;
    margin: 20px auto;
    padding: 20px;
    background: #fff;
    border-radius: 8px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}
h1 {
    color: #0066cc;
    font-weight: bold;
    text-align: center;
    margin-bottom: 20px;
}
.intro {
    text-align: center;
    color: #666;
    margin-bottom: 30px;
}
.form-group {
    margin-bottom: 20px;
}
label {
    display: block;
    font-weight: bold;
    margin-bottom: 5px;
    color: #333;
}
.form-control {
    width: 100%;
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 4px;
    font-size: 16px;
}
.form-control:focus {
    border-color: #0066cc;
    outline: none;
}
.form-actions {
    text-align: center;
}
.btn {
    padding: 10px 20px;
    border-radius: 4px;
    border: none;
    cursor: pointer;
    font-weight: bold;
}
.btn-primary {
    background-color: #0066cc;
    color: white;
}
.btn-secondary {
    background-color: #999;
    color: white;
    text-decoration: none;
}
</style>

<div class="container">
    <h1>Registrar Cita Médica</h1>
    <p class="intro">Selecciona un paciente existente y agenda su cita. Si el paciente no existe, regístralo primero en 
        <a asp-controller="Pacientes" asp-action="RegistrarPaciente">Registrar Paciente</a>.
    </p>

    <!-- Formulario corregido -->
    <form asp-action="RegistrarCitaPaciente" method="post">

        <div class="form-group">
            <label for="DNI_Paciente">DNI del Paciente *</label>
            <input type="text" id="DNI_Paciente" name="DNI_Paciente" class="form-control" placeholder="Ingrese DNI del paciente" maxlength="8" required>

            <!-- Campo oculto con el ID del paciente -->
            <input type="hidden" id="PacienteId" name="PacienteId" />

            <small id="pacienteInfo" class="form-text text-muted">
                El paciente se buscará automáticamente al ingresar el DNI.
            </small>

            <div id="datosPaciente" class="alert alert-info" style="display: none;">
                <strong>Paciente Encontrado:</strong> <span id="nombrePaciente"></span> 
                    (Edad: <span id="edadPaciente"></span>)
            </div>
        </div>

        <div class="form-group">
            <label for="Fecha_CitaMedica">Fecha de la Cita Médica *</label>
            <input type="date" id="Fecha_CitaMedica" name="Fecha_CitaMedica" class="form-control" required min="@DateTime.Now.ToString("yyyy-MM-dd")">
        </div>

        <div class="form-group">
            <label for="Hora_CitaMedica">Hora de la Cita Médica *</label>
            <input type="time" id="Hora_CitaMedica" name="Hora_CitaMedica" class="form-control" required>
        </div>

        <div class="form-group">
            <label for="Especialidad">Especialidad *</label>
            <select id="Especialidad" name="Especialidad" class="form-control" required>
                <option value="">Selecciona una especialidad</option>
                <option value="Cardiología">Cardiología</option>
                <option value="Pediatría">Pediatría</option>
                <option value="Medicina General">Medicina General</option>
                <option value="Laboratorio Clínico">Laboratorio Clínico</option>
            </select>
        </div>

        <div class="form-group">
            <label for="Medico">Médico (Opcional)</label>
            <input type="text" id="Medico" name="Medico" class="form-control" placeholder="Nombre del médico asignado">
        </div>

        <div class="form-group">
            <label for="Observaciones">Observaciones</label>
            <textarea id="Observaciones" name="Observaciones" class="form-control" rows="3" placeholder="Notas adicionales sobre la cita Médica"></textarea>
        </div>

        <div class="form-actions">
            <button type="submit" class="btn btn-primary">Registrar Cita</button>
            <a href="@Url.Action("ListaCitasMedicas")" class="btn btn-secondary">Cancelar</a>
        </div>
    </form>
</div>



@section Scripts {
<script>
    document.getElementById("DNI_Paciente").addEventListener("blur", function () {
        var dni = this.value.trim();

        if (dni.length === 8) {
            fetch(`/Pacientes/BuscarPorDNI?dni=${dni}`)
                .then(response => response.json())
                .then(data => {
                    if (data && data.id) {
                        document.getElementById("PacienteId").value = data.id;
                        document.getElementById("nombrePaciente").textContent = data.nombreCompleto;
                        document.getElementById("edadPaciente").textContent = data.edad;
                        document.getElementById("datosPaciente").style.display = "block";
                    } else {
                        document.getElementById("datosPaciente").style.display = "none";
                        alert("Paciente no encontrado. Regístralo primero.");
                    }
                })
                .catch(error => console.error("Error al buscar paciente:", error));
        }
    });
</script>
}
